define(["./AttributeCompression-7ac8aa9b","./Cartesian3-9e1fac2b","./Cartographic-832093e6","./Color-d2102f41","./defaultValue-a9572088","./Ellipsoid-a181f4f7","./IndexDatatype-42a29532","./Math-42d8c121","./OrientedBoundingBox-4c78d647","./Rectangle-15196776","./createTaskProcessorWorker","./Check-1ab97039","./FeatureDetection-b832308f","./defer-027bcf35","./WebGLConstants-ade65f0f","./buildModuleUrl-0b6ed7f4","./PrimitiveType-56cd8f05","./Cartesian4-c70aabd2","./RuntimeError-7a3815c0","./Event-086a9f30","./EllipsoidTangentPlane-c14b1868","./IntersectionTests-b7b35aa4","./Plane-5520c09d","./GeometryAttribute-96eb6e6a","./PolygonPipeline-2e7b86a0","./ComponentDatatype-00a8741a","./EllipsoidRhumbLine-07313960"],(function(e,a,r,t,n,o,i,f,s,c,d,u,h,l,p,b,g,y,v,I,m,w,x,A,E,N,T){"use strict";var k=new a.o,L=new o.t,P=new c.h,C={min:void 0,max:void 0,indexBytesPerElement:void 0};function U(e,a,r){var n=a.length,o=2+n*s.p.packedLength+1+function(e){for(var a=e.length,r=0,n=0;n<a;++n)r+=t.e.packedLength+3+e[n].batchIds.length;return r}(r),i=new Float64Array(o),f=0;i[f++]=e,i[f++]=n;for(var c=0;c<n;++c)s.p.pack(a[c],i,f),f+=s.p.packedLength;var d=r.length;i[f++]=d;for(var u=0;u<d;++u){var h=r[u];t.e.pack(h.color,i,f),f+=t.e.packedLength,i[f++]=h.offset,i[f++]=h.count;var l=h.batchIds,p=l.length;i[f++]=p;for(var b=0;b<p;++b)i[f++]=l[b]}return i}var O=new a.o,F=new a.o,B=new a.o,D=new a.o,S=new a.o,R=new r.a,_=new c.h;return d((function(d,u){var h;!function(e){var r=new Float64Array(e),t=0;C.indexBytesPerElement=r[t++],C.min=r[t++],C.max=r[t++],a.o.unpack(r,t,k),t+=a.o.packedLength,o.t.unpack(r,t,L),t+=o.t.packedLength,c.h.unpack(r,t,P)}(d.packedBuffer),h=2===C.indexBytesPerElement?new Uint16Array(d.indices):new Uint32Array(d.indices);var l,p,b,g=new Uint16Array(d.positions),y=new Uint32Array(d.counts),v=new Uint32Array(d.indexCounts),I=new Uint32Array(d.batchIds),m=new Uint32Array(d.batchTableColors),w=new Array(y.length),x=k,A=L,E=P,N=C.min,T=C.max,G=d.minimumHeights,M=d.maximumHeights;n.e(G)&&n.e(M)&&(G=new Float32Array(G),M=new Float32Array(M));var V=g.length/2,Y=g.subarray(0,V),H=g.subarray(V,2*V);e.t.zigZagDeltaDecode(Y,H);var W=new Float32Array(3*V);for(l=0;l<V;++l){var z=Y[l],Z=H[l],j=f.e.lerp(E.west,E.east,z/32767),q=f.e.lerp(E.south,E.north,Z/32767),J=r.a.fromRadians(j,q,0,R),K=A.cartographicToCartesian(J,O);a.o.pack(K,W,3*l)}var Q=y.length,X=new Array(Q),$=new Array(Q),ee=0,ae=0;for(l=0;l<Q;++l)X[l]=ee,$[l]=ae,ee+=y[l],ae+=v[l];var re,te=new Float32Array(3*V*2),ne=new Uint16Array(2*V),oe=new Uint32Array($.length),ie=new Uint32Array(v.length),fe=[],se={};for(l=0;l<Q;++l)b=m[l],n.e(se[b])?(se[b].positionLength+=y[l],se[b].indexLength+=v[l],se[b].batchIds.push(l)):se[b]={positionLength:y[l],indexLength:v[l],offset:0,indexOffset:0,batchIds:[l]};var ce=0,de=0;for(b in se)if(se.hasOwnProperty(b)){(re=se[b]).offset=ce,re.indexOffset=de;var ue=2*re.positionLength,he=2*re.indexLength+6*re.positionLength;ce+=ue,de+=he,re.indexLength=he}var le=[];for(b in se)se.hasOwnProperty(b)&&(re=se[b],le.push({color:t.e.fromRgba(parseInt(b)),offset:re.indexOffset,count:re.indexLength,batchIds:re.batchIds}));for(l=0;l<Q;++l){var pe=(re=se[b=m[l]]).offset,be=3*pe,ge=pe,ye=X[l],ve=y[l],Ie=I[l],me=N,we=T;n.e(G)&&n.e(M)&&(me=G[l],we=M[l]);var xe=Number.POSITIVE_INFINITY,Ae=Number.NEGATIVE_INFINITY,Ee=Number.POSITIVE_INFINITY,Ne=Number.NEGATIVE_INFINITY;for(p=0;p<ve;++p){var Te=a.o.unpack(W,3*ye+3*p,O);A.scaleToGeodeticSurface(Te,Te);var ke=A.cartesianToCartographic(Te,R),Le=ke.latitude,Pe=ke.longitude;xe=Math.min(Le,xe),Ae=Math.max(Le,Ae),Ee=Math.min(Pe,Ee),Ne=Math.max(Pe,Ne);var Ce=A.geodeticSurfaceNormal(Te,F),Ue=a.o.multiplyByScalar(Ce,me,B),Oe=a.o.add(Te,Ue,D);Ue=a.o.multiplyByScalar(Ce,we,Ue);var Fe=a.o.add(Te,Ue,S);a.o.subtract(Fe,x,Fe),a.o.subtract(Oe,x,Oe),a.o.pack(Fe,te,be),a.o.pack(Oe,te,be+3),ne[ge]=Ie,ne[ge+1]=Ie,be+=6,ge+=2}(E=_).west=Ee,E.east=Ne,E.south=xe,E.north=Ae,w[l]=s.p.fromRectangle(E,N,T,A);var Be=re.indexOffset,De=$[l],Se=v[l];for(oe[l]=Be,p=0;p<Se;p+=3){var Re=h[De+p]-ye,_e=h[De+p+1]-ye,Ge=h[De+p+2]-ye;fe[Be++]=2*Re+pe,fe[Be++]=2*_e+pe,fe[Be++]=2*Ge+pe,fe[Be++]=2*Ge+1+pe,fe[Be++]=2*_e+1+pe,fe[Be++]=2*Re+1+pe}for(p=0;p<ve;++p){var Me=p,Ve=(p+1)%ve;fe[Be++]=2*Me+1+pe,fe[Be++]=2*Ve+pe,fe[Be++]=2*Me+pe,fe[Be++]=2*Me+1+pe,fe[Be++]=2*Ve+1+pe,fe[Be++]=2*Ve+pe}re.offset+=2*ve,re.indexOffset=Be,ie[l]=Be-oe[l]}fe=i.IndexDatatype.createTypedArray(te.length/3,fe);for(var Ye=le.length,He=0;He<Ye;++He){for(var We=le[He].batchIds,ze=0,Ze=We.length,je=0;je<Ze;++je)ze+=ie[We[je]];le[He].count=ze}var qe=U(2===fe.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,w,le);return u.push(te.buffer,fe.buffer,oe.buffer,ie.buffer,ne.buffer,qe.buffer),{positions:te.buffer,indices:fe.buffer,indexOffsets:oe.buffer,indexCounts:ie.buffer,batchIds:ne.buffer,packedBuffer:qe.buffer}}))}));
