define(["./arrayFill-69e0407a","./arrayRemoveDuplicates-d492b4a7","./buildModuleUrl-0b6ed7f4","./Cartesian3-9e1fac2b","./Cartographic-832093e6","./Check-1ab97039","./ComponentDatatype-00a8741a","./PolylineVolumeGeometryLibrary-5bbf5820","./CorridorGeometryLibrary-33dda2a1","./defaultValue-a9572088","./Ellipsoid-a181f4f7","./GeometryAttribute-96eb6e6a","./GeometryAttributes-ba165842","./GeometryOffsetAttribute-b4d599f5","./IndexDatatype-42a29532","./Math-42d8c121","./PolygonPipeline-2e7b86a0","./PrimitiveType-56cd8f05","./Rectangle-15196776","./VertexFormat-54ae028d","./FeatureDetection-b832308f","./defer-027bcf35","./Event-086a9f30","./RuntimeError-7a3815c0","./WebGLConstants-ade65f0f","./Cartesian4-c70aabd2","./EllipsoidTangentPlane-c14b1868","./IntersectionTests-b7b35aa4","./Plane-5520c09d","./PolylinePipeline-6c04f0e5","./EllipsoidGeodesic-acb826bd","./EllipsoidRhumbLine-07313960"],(function(t,e,o,a,r,i,n,s,l,d,u,c,f,m,h,p,g,b,v,y,A,_,w,T,E,N,D,P,I,x,F,O){"use strict";var M=new a.o,S=new a.o,L=new a.o,V=new a.o,C=new a.o,G=new a.o,k=new a.o,R=new a.o;function z(t,e){for(var o=0;o<t.length;o++)t[o]=e.scaleToGeodeticSurface(t[o],t[o]);return t}function H(t,e,o,r,i,n){var s=t.normals,d=t.tangents,u=t.bitangents,c=a.o.normalize(a.o.cross(o,e,k),k);n.normal&&l.b.addAttribute(s,e,r,i),n.tangent&&l.b.addAttribute(d,c,r,i),n.bitangent&&l.b.addAttribute(u,o,r,i)}function U(t,e,o){var r,i,s,u=t.positions,m=t.corners,g=t.endPositions,b=t.lefts,v=t.normals,y=new f.a,A=0,_=0,w=0;for(i=0;i<u.length;i+=2)A+=s=u[i].length-3,w+=2*s,_+=u[i+1].length-3;for(A+=3,_+=3,i=0;i<m.length;i++){r=m[i];var T=m[i].leftPositions;d.e(T)?(A+=s=T.length,w+=s):(_+=s=m[i].rightPositions.length,w+=s)}var E,N=d.e(g);N&&(A+=E=g[0].length-3,_+=E,w+=6*(E/=3));var D,P,I,x,F,O,C=A+_,z=new Float64Array(C),U={normals:e.normal?new Float32Array(C):void 0,tangents:e.tangent?new Float32Array(C):void 0,bitangents:e.bitangent?new Float32Array(C):void 0},Y=0,B=C-1,W=M,q=S,J=E/2,j=h.IndexDatatype.createTypedArray(C/3,w),K=0;if(N){O=L,F=V;var Q=g[0];for(W=a.o.fromArray(v,0,W),q=a.o.fromArray(b,0,q),i=0;i<J;i++)O=a.o.fromArray(Q,3*(J-1-i),O),F=a.o.fromArray(Q,3*(J+i),F),l.b.addAttribute(z,F,Y),l.b.addAttribute(z,O,void 0,B),H(U,W,q,Y,B,e),x=(P=Y/3)+1,I=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3}var X,Z,$=0,tt=0,et=u[$++],ot=u[$++];for(z.set(et,Y),z.set(ot,B-ot.length+1),q=a.o.fromArray(b,tt,q),s=ot.length-3,i=0;i<s;i+=3)X=o.geodeticSurfaceNormal(a.o.fromArray(et,i,k),k),Z=o.geodeticSurfaceNormal(a.o.fromArray(ot,s-i,R),R),H(U,W=a.o.normalize(a.o.add(X,Z,W),W),q,Y,B,e),x=(P=Y/3)+1,I=(D=(B-2)/3)-1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3;for(X=o.geodeticSurfaceNormal(a.o.fromArray(et,s,k),k),Z=o.geodeticSurfaceNormal(a.o.fromArray(ot,s,R),R),W=a.o.normalize(a.o.add(X,Z,W),W),tt+=3,i=0;i<m.length;i++){var at,rt,it,nt=(r=m[i]).leftPositions,st=r.rightPositions,lt=G,dt=L,ut=V;if(W=a.o.fromArray(v,tt,W),d.e(nt)){for(H(U,W,q,void 0,B,e),B-=3,rt=x,it=I,at=0;at<nt.length/3;at++)lt=a.o.fromArray(nt,3*at,lt),j[K++]=rt,j[K++]=it-at-1,j[K++]=it-at,l.b.addAttribute(z,lt,void 0,B),dt=a.o.fromArray(z,3*(it-at-1),dt),ut=a.o.fromArray(z,3*rt,ut),H(U,W,q=a.o.normalize(a.o.subtract(dt,ut,q),q),void 0,B,e),B-=3;lt=a.o.fromArray(z,3*rt,lt),dt=a.o.subtract(a.o.fromArray(z,3*it,dt),lt,dt),ut=a.o.subtract(a.o.fromArray(z,3*(it-at),ut),lt,ut),H(U,W,q=a.o.normalize(a.o.add(dt,ut,q),q),Y,void 0,e),Y+=3}else{for(H(U,W,q,Y,void 0,e),Y+=3,rt=I,it=x,at=0;at<st.length/3;at++)lt=a.o.fromArray(st,3*at,lt),j[K++]=rt,j[K++]=it+at,j[K++]=it+at+1,l.b.addAttribute(z,lt,Y),dt=a.o.fromArray(z,3*rt,dt),ut=a.o.fromArray(z,3*(it+at),ut),H(U,W,q=a.o.normalize(a.o.subtract(dt,ut,q),q),Y,void 0,e),Y+=3;lt=a.o.fromArray(z,3*rt,lt),dt=a.o.subtract(a.o.fromArray(z,3*(it+at),dt),lt,dt),ut=a.o.subtract(a.o.fromArray(z,3*it,ut),lt,ut),H(U,W,q=a.o.normalize(a.o.negate(a.o.add(ut,dt,q),q),q),void 0,B,e),B-=3}for(et=u[$++],ot=u[$++],et.splice(0,3),ot.splice(ot.length-3,3),z.set(et,Y),z.set(ot,B-ot.length+1),s=ot.length-3,tt+=3,q=a.o.fromArray(b,tt,q),at=0;at<ot.length;at+=3)X=o.geodeticSurfaceNormal(a.o.fromArray(et,at,k),k),Z=o.geodeticSurfaceNormal(a.o.fromArray(ot,s-at,R),R),H(U,W=a.o.normalize(a.o.add(X,Z,W),W),q,Y,B,e),P=(x=Y/3)-1,D=(I=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3;Y-=3,B+=3}if(H(U,W=a.o.fromArray(v,v.length-3,W),q,Y,B,e),N){Y+=3,B-=3,O=L,F=V;var ct=g[1];for(i=0;i<J;i++)O=a.o.fromArray(ct,3*(E-i-1),O),F=a.o.fromArray(ct,3*i,F),l.b.addAttribute(z,O,void 0,B),l.b.addAttribute(z,F,Y),H(U,W,q,Y,B,e),P=(x=Y/3)-1,D=(I=(B-2)/3)+1,j[K++]=D,j[K++]=P,j[K++]=I,j[K++]=I,j[K++]=P,j[K++]=x,Y+=3,B-=3}if(y.position=new c.o({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:z}),e.st){var ft,mt,ht=new Float32Array(C/3*2),pt=0;if(N){A/=3,_/=3;var gt=Math.PI/(E+1);mt=1/(A-E+1),ft=1/(_-E+1);var bt,vt=E/2;for(i=vt+1;i<E+1;i++)bt=p.e.PI_OVER_TWO+gt*i,ht[pt++]=ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=1;i<_-E+1;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=E;i>vt;i--)bt=p.e.PI_OVER_TWO-i*gt,ht[pt++]=1-ft*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=vt;i>0;i--)bt=p.e.PI_OVER_TWO-gt*i,ht[pt++]=1-mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt));for(i=A-E;i>0;i--)ht[pt++]=i*mt,ht[pt++]=1;for(i=1;i<vt+1;i++)bt=p.e.PI_OVER_TWO+gt*i,ht[pt++]=mt*(1+Math.cos(bt)),ht[pt++]=.5*(1+Math.sin(bt))}else{for(mt=1/((A/=3)-1),ft=1/((_/=3)-1),i=0;i<_;i++)ht[pt++]=i*ft,ht[pt++]=0;for(i=A;i>0;i--)ht[pt++]=(i-1)*mt,ht[pt++]=1}y.st=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:ht})}return e.normal&&(y.normal=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.normals})),e.tangent&&(y.tangent=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.tangents})),e.bitangent&&(y.bitangent=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U.bitangents})),{attributes:y,indices:j}}function Y(t,e,o){o[e++]=t[0],o[e++]=t[1],o[e++]=t[2];for(var a=3;a<t.length;a+=3){var r=t[a],i=t[a+1],n=t[a+2];o[e++]=r,o[e++]=i,o[e++]=n,o[e++]=r,o[e++]=i,o[e++]=n}return o[e++]=t[0],o[e++]=t[1],o[e++]=t[2],o}function B(e,o){var r=new y.n({position:o.position,normal:o.normal||o.bitangent||e.shadowVolume,tangent:o.tangent,bitangent:o.normal||o.bitangent,st:o.st}),i=e.ellipsoid,s=U(l.b.computePositions(e),r,i),u=e.height,f=e.extrudedHeight,p=s.attributes,b=s.indices,v=p.position.values,A=v.length,_=new Float64Array(6*A),w=new Float64Array(A);w.set(v);var T=new Float64Array(4*A);T=Y(v=g.A.scaleToGeodeticHeight(v,u,i),0,T),T=Y(w=g.A.scaleToGeodeticHeight(w,f,i),2*A,T),_.set(v),_.set(w,A),_.set(T,2*A),p.position.values=_,p=function(t,e){if(!(e.normal||e.tangent||e.bitangent||e.st))return t;var o,r,i=t.position.values;(e.normal||e.bitangent)&&(o=t.normal.values,r=t.bitangent.values);var n,s=t.position.values.length/18,d=3*s,u=2*s,c=2*d;if(e.normal||e.bitangent||e.tangent){var f=e.normal?new Float32Array(6*d):void 0,m=e.tangent?new Float32Array(6*d):void 0,h=e.bitangent?new Float32Array(6*d):void 0,p=M,g=S,b=L,v=V,y=C,A=G,_=c;for(n=0;n<d;n+=3){var w=_+c;p=a.o.fromArray(i,n,p),g=a.o.fromArray(i,n+d,g),b=a.o.fromArray(i,(n+3)%d,b),g=a.o.subtract(g,p,g),b=a.o.subtract(b,p,b),v=a.o.normalize(a.o.cross(g,b,v),v),e.normal&&(l.b.addAttribute(f,v,w),l.b.addAttribute(f,v,w+3),l.b.addAttribute(f,v,_),l.b.addAttribute(f,v,_+3)),(e.tangent||e.bitangent)&&(A=a.o.fromArray(o,n,A),e.bitangent&&(l.b.addAttribute(h,A,w),l.b.addAttribute(h,A,w+3),l.b.addAttribute(h,A,_),l.b.addAttribute(h,A,_+3)),e.tangent&&(y=a.o.normalize(a.o.cross(A,v,y),y),l.b.addAttribute(m,y,w),l.b.addAttribute(m,y,w+3),l.b.addAttribute(m,y,_),l.b.addAttribute(m,y,_+3))),_+=6}if(e.normal){for(f.set(o),n=0;n<d;n+=3)f[n+d]=-o[n],f[n+d+1]=-o[n+1],f[n+d+2]=-o[n+2];t.normal.values=f}else t.normal=void 0;if(e.bitangent?(h.set(r),h.set(r,d),t.bitangent.values=h):t.bitangent=void 0,e.tangent){var T=t.tangent.values;m.set(T),m.set(T,d),t.tangent.values=m}}if(e.st){var E=t.st.values,N=new Float32Array(6*u);N.set(E),N.set(E,u);for(var D=2*u,P=0;P<2;P++){for(N[D++]=E[0],N[D++]=E[1],n=2;n<u;n+=2){var I=E[n],x=E[n+1];N[D++]=I,N[D++]=x,N[D++]=I,N[D++]=x}N[D++]=E[0],N[D++]=E[1]}t.st.values=N}return t}(p,o);var E,N=A/3;if(e.shadowVolume){var D=p.normal.values;A=D.length;var P=new Float32Array(6*A);for(E=0;E<A;E++)D[E]=-D[E];P.set(D,A),P=Y(D,4*A,P),p.extrudeDirection=new c.o({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),o.normal||(p.normal=void 0)}if(d.e(e.offsetAttribute)){var I=new Uint8Array(6*N);if(e.offsetAttribute===m.z.TOP)I=t.d(I,1,0,N),I=t.d(I,1,2*N,4*N);else{var x=e.offsetAttribute===m.z.NONE?0:1;I=t.d(I,x)}p.applyOffset=new c.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:I})}var F=b.length,O=N+N,k=h.IndexDatatype.createTypedArray(_.length/3,2*F+3*O);k.set(b);var R,z,H,B,W=F;for(E=0;E<F;E+=3){var q=b[E],J=b[E+1],j=b[E+2];k[W++]=j+N,k[W++]=J+N,k[W++]=q+N}for(E=0;E<O;E+=2)H=(R=E+O)+1,B=(z=R+O)+1,k[W++]=R,k[W++]=z,k[W++]=H,k[W++]=H,k[W++]=z,k[W++]=B;return{attributes:p,indices:k}}var W=new a.o,q=new a.o,J=new r.a;function j(t,e,o,r,i,n){var s=a.o.subtract(e,t,W);a.o.normalize(s,s);var l=o.geodeticSurfaceNormal(t,q),d=a.o.cross(s,l,W);a.o.multiplyByScalar(d,r,d);var u=i.latitude,c=i.longitude,f=n.latitude,m=n.longitude;a.o.add(t,d,q),o.cartesianToCartographic(q,J);var h=J.latitude,p=J.longitude;u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),a.o.subtract(t,d,q),o.cartesianToCartographic(q,J),h=J.latitude,p=J.longitude,u=Math.min(u,h),c=Math.min(c,p),f=Math.max(f,h),m=Math.max(m,p),i.latitude=u,i.longitude=c,n.latitude=f,n.longitude=m}var K=new a.o,Q=new a.o,X=new r.a,Z=new r.a;function $(t,o,r,i,n){t=z(t,o);var l=e.D(t,a.o.equalsEpsilon),u=l.length;if(u<2||r<=0)return new v.h;var c,f,m=.5*r;if(X.latitude=Number.POSITIVE_INFINITY,X.longitude=Number.POSITIVE_INFINITY,Z.latitude=Number.NEGATIVE_INFINITY,Z.longitude=Number.NEGATIVE_INFINITY,i===s.S.ROUNDED){var h=l[0];a.o.subtract(h,l[1],K),a.o.normalize(K,K),a.o.multiplyByScalar(K,m,K),a.o.add(h,K,Q),o.cartesianToCartographic(Q,J),c=J.latitude,f=J.longitude,X.latitude=Math.min(X.latitude,c),X.longitude=Math.min(X.longitude,f),Z.latitude=Math.max(Z.latitude,c),Z.longitude=Math.max(Z.longitude,f)}for(var p=0;p<u-1;++p)j(l[p],l[p+1],o,m,X,Z);var g=l[u-1];a.o.subtract(g,l[u-2],K),a.o.normalize(K,K),a.o.multiplyByScalar(K,m,K),a.o.add(g,K,Q),j(g,Q,o,m,X,Z),i===s.S.ROUNDED&&(o.cartesianToCartographic(Q,J),c=J.latitude,f=J.longitude,X.latitude=Math.min(X.latitude,c),X.longitude=Math.min(X.longitude,f),Z.latitude=Math.max(Z.latitude,c),Z.longitude=Math.max(Z.longitude,f));var b=d.e(n)?n:new v.h;return b.north=Z.latitude,b.south=X.latitude,b.east=Z.longitude,b.west=X.longitude,b}function tt(t){var e=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,o=t.width;i.o.defined("options.positions",e),i.o.defined("options.width",o);var r=d.u(t.height,0),n=d.u(t.extrudedHeight,r);this._positions=e,this._ellipsoid=u.t.clone(d.u(t.ellipsoid,u.t.WGS84)),this._vertexFormat=y.n.clone(d.u(t.vertexFormat,y.n.DEFAULT)),this._width=o,this._height=Math.max(r,n),this._extrudedHeight=Math.min(r,n),this._cornerType=d.u(t.cornerType,s.S.ROUNDED),this._granularity=d.u(t.granularity,p.e.RADIANS_PER_DEGREE),this._shadowVolume=d.u(t.shadowVolume,!1),this._workerName="createCorridorGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this.packedLength=1+e.length*a.o.packedLength+u.t.packedLength+y.n.packedLength+7}tt.pack=function(t,e,o){i.o.defined("value",t),i.o.defined("array",e),o=d.u(o,0);var r=t._positions,n=r.length;e[o++]=n;for(var s=0;s<n;++s,o+=a.o.packedLength)a.o.pack(r[s],e,o);return u.t.pack(t._ellipsoid,e,o),o+=u.t.packedLength,y.n.pack(t._vertexFormat,e,o),o+=y.n.packedLength,e[o++]=t._width,e[o++]=t._height,e[o++]=t._extrudedHeight,e[o++]=t._cornerType,e[o++]=t._granularity,e[o++]=t._shadowVolume?1:0,e[o]=d.u(t._offsetAttribute,-1),e};var et=u.t.clone(u.t.UNIT_SPHERE),ot=new y.n,at={positions:void 0,ellipsoid:et,vertexFormat:ot,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};return tt.unpack=function(t,e,o){i.o.defined("array",t),e=d.u(e,0);for(var r=t[e++],n=new Array(r),s=0;s<r;++s,e+=a.o.packedLength)n[s]=a.o.unpack(t,e);var l=u.t.unpack(t,e,et);e+=u.t.packedLength;var c=y.n.unpack(t,e,ot);e+=y.n.packedLength;var f=t[e++],m=t[e++],h=t[e++],p=t[e++],g=t[e++],b=1===t[e++],v=t[e];return d.e(o)?(o._positions=n,o._ellipsoid=u.t.clone(l,o._ellipsoid),o._vertexFormat=y.n.clone(c,o._vertexFormat),o._width=f,o._height=m,o._extrudedHeight=h,o._cornerType=p,o._granularity=g,o._shadowVolume=b,o._offsetAttribute=-1===v?void 0:v,o):(at.positions=n,at.width=f,at.height=m,at.extrudedHeight=h,at.cornerType=p,at.granularity=g,at.shadowVolume=b,at.offsetAttribute=-1===v?void 0:v,new tt(at))},tt.computeRectangle=function(t,e){var o=(t=d.u(t,d.u.EMPTY_OBJECT)).positions,a=t.width;return i.o.defined("options.positions",o),i.o.defined("options.width",a),$(o,d.u(t.ellipsoid,u.t.WGS84),a,d.u(t.cornerType,s.S.ROUNDED),e)},tt.createGeometry=function(r){var i=r._positions,s=r._width,u=r._ellipsoid;i=z(i,u);var f=e.D(i,a.o.equalsEpsilon);if(!(f.length<2||s<=0)){var h,v=r._height,y=r._extrudedHeight,A=!p.e.equalsEpsilon(v,y,0,p.e.EPSILON2),_=r._vertexFormat,w={ellipsoid:u,positions:f,width:s,cornerType:r._cornerType,granularity:r._granularity,saveAttributes:!0};if(A)w.height=v,w.extrudedHeight=y,w.shadowVolume=r._shadowVolume,w.offsetAttribute=r._offsetAttribute,h=B(w,_);else if((h=U(l.b.computePositions(w),_,u)).attributes.position.values=g.A.scaleToGeodeticHeight(h.attributes.position.values,v,u),d.e(r._offsetAttribute)){var T=r._offsetAttribute===m.z.NONE?0:1,E=h.attributes.position.values.length,N=new Uint8Array(E/3);t.d(N,T),h.attributes.applyOffset=new c.o({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:N})}var D=h.attributes,P=o.i.fromVertices(D.position.values,void 0,3);return _.position||(h.attributes.position.values=void 0),new c.I({attributes:D,indices:h.indices,primitiveType:b._0x4e53a2.TRIANGLES,boundingSphere:P,offsetAttribute:r._offsetAttribute})}},tt.createShadowVolume=function(t,e,o){var a=t._granularity,r=t._ellipsoid,i=e(a,r),n=o(a,r);return new tt({positions:t._positions,width:t._width,cornerType:t._cornerType,ellipsoid:r,granularity:a,extrudedHeight:i,height:n,vertexFormat:y.n.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(tt.prototype,{rectangle:{get:function(){return d.e(this._rectangle)||(this._rectangle=$(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}}),function(t,e){return d.e(e)&&(t=tt.unpack(t,e)),t._ellipsoid=u.t.clone(t._ellipsoid),tt.createGeometry(t)}}));
