define(["./defaultValue-a9572088","./Ellipsoid-a181f4f7","./buildModuleUrl-0b6ed7f4","./Cartesian3-9e1fac2b","./ComponentDatatype-00a8741a","./Check-1ab97039","./GeometryAttribute-96eb6e6a","./GeometryAttributes-ba165842","./IndexDatatype-42a29532","./Math-42d8c121","./PrimitiveType-56cd8f05","./VertexFormat-54ae028d","./WallGeometryLibrary-e5562831","./Cartographic-832093e6","./FeatureDetection-b832308f","./defer-027bcf35","./Rectangle-15196776","./Event-086a9f30","./RuntimeError-7a3815c0","./WebGLConstants-ade65f0f","./Cartesian4-c70aabd2","./arrayRemoveDuplicates-d492b4a7","./PolylinePipeline-6c04f0e5","./EllipsoidGeodesic-acb826bd","./EllipsoidRhumbLine-07313960","./IntersectionTests-b7b35aa4","./Plane-5520c09d"],(function(e,t,o,n,i,a,r,s,m,p,u,l,c,h,g,d,v,y,f,w,b,_,A,x,k,C,E){"use strict";var L=new n.o,F=new n.o,P=new n.o,D=new n.o,H=new n.o,T=new n.o,G=new n.o,O=new n.o;function z(o){var i=(o=e.u(o,e.u.EMPTY_OBJECT)).positions,r=o.maximumHeights,s=o.minimumHeights;if(!e.e(i))throw new a.t("options.positions is required.");if(e.e(r)&&r.length!==i.length)throw new a.t("options.positions and options.maximumHeights must have the same length.");if(e.e(s)&&s.length!==i.length)throw new a.t("options.positions and options.minimumHeights must have the same length.");var m=e.u(o.vertexFormat,l.n.DEFAULT),u=e.u(o.granularity,p.e.RADIANS_PER_DEGREE),c=e.u(o.ellipsoid,t.t.WGS84);this._positions=i,this._minimumHeights=s,this._maximumHeights=r,this._vertexFormat=l.n.clone(m),this._granularity=u,this._ellipsoid=t.t.clone(c),this._enuCenter=o.enuCenter,this._workerName="createWallGeometry";var h=1+i.length*n.o.packedLength+2;e.e(s)&&(h+=s.length),e.e(r)&&(h+=r.length),this.packedLength=h+t.t.packedLength+l.n.packedLength+1,this.packedLength+=n.o.packedLength}z.pack=function(o,i,r){if(!e.e(o))throw new a.t("value is required");if(!e.e(i))throw new a.t("array is required");r=e.u(r,0);var s,m=o._positions,p=m.length;for(i[r++]=p,s=0;s<p;++s,r+=n.o.packedLength)n.o.pack(m[s],i,r);var u=o._minimumHeights;if(p=e.e(u)?u.length:0,i[r++]=p,e.e(u))for(s=0;s<p;++s)i[r++]=u[s];var c=o._maximumHeights;if(p=e.e(c)?c.length:0,i[r++]=p,e.e(c))for(s=0;s<p;++s)i[r++]=c[s];return t.t.pack(o._ellipsoid,i,r),r+=t.t.packedLength,l.n.pack(o._vertexFormat,i,r),r+=l.n.packedLength,i[r++]=o._granularity,e.e(o._enuCenter)?n.o.pack(o._enuCenter,i,r):n.o.pack(n.o.ZERO,i,r),i};var R=t.t.clone(t.t.UNIT_SPHERE),I=new l.n,S={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:R,vertexFormat:I,granularity:void 0,enuCenter:void 0};return z.unpack=function(o,i,r){if(!e.e(o))throw new a.t("array is required");i=e.u(i,0);var s,m,p,u=o[i++],c=new Array(u);for(s=0;s<u;++s,i+=n.o.packedLength)c[s]=n.o.unpack(o,i);if((u=o[i++])>0)for(m=new Array(u),s=0;s<u;++s)m[s]=o[i++];if((u=o[i++])>0)for(p=new Array(u),s=0;s<u;++s)p[s]=o[i++];var h=t.t.unpack(o,i,R);i+=t.t.packedLength;var g=l.n.unpack(o,i,I);i+=l.n.packedLength;var d=o[i++],v=n.o.unpack(o,i);return n.o.equals(v,n.o.ZERO)&&(v=void 0),e.e(r)?(r._positions=c,r._minimumHeights=m,r._maximumHeights=p,r._ellipsoid=t.t.clone(h,r._ellipsoid),r._vertexFormat=l.n.clone(g,r._vertexFormat),r._granularity=d,r._enuCenter=v,r):(S.positions=c,S.minimumHeights=m,S.maximumHeights=p,S.granularity=d,S.enuCenter=v,new z(S))},z.fromConstantHeights=function(t){var o=(t=e.u(t,e.u.EMPTY_OBJECT)).positions;if(!e.e(o))throw new a.t("options.positions is required.");var n,i,r=t.minimumHeight,s=t.maximumHeight,m=e.e(r),p=e.e(s);if(m||p){var u=o.length;n=m?new Array(u):void 0,i=p?new Array(u):void 0;for(var l=0;l<u;++l)m&&(n[l]=r),p&&(i[l]=s)}return new z({positions:o,maximumHeights:i,minimumHeights:n,ellipsoid:t.ellipsoid,vertexFormat:t.vertexFormat})},z.createGeometry=function(t){var a=t._positions,l=t._minimumHeights,h=t._maximumHeights,g=t._vertexFormat,d=t._granularity,v=t._ellipsoid,y=t._enuCenter,f=c.D.computePositions(v,a,h,l,d,!0,y);if(e.e(f.pos)){var w;e.e(y)&&(w=r.m.eastNorthUpToFixedFrame(y));var b,_=f.pos.bottomPositions,A=f.pos.topPositions,x=f.pos.numCorners,k=A.length,C=2*k,E=g.position?new Float64Array(C):void 0,z=g.normal?new Float32Array(C):void 0,R=g.tangent?new Float32Array(C):void 0,I=g.bitangent?new Float32Array(C):void 0,S=g.st?new Float32Array(C/3*2):void 0,q=0,N=0,U=0,B=0,M=0,W=O,V=G,Z=T,J=!0,Y=0,j=1/((k/=3)-a.length+1);for(b=0;b<k;++b){var K=3*b,Q=n.o.fromArray(A,K,L),X=n.o.fromArray(_,K,F);if(g.position&&(E[q++]=X.x,E[q++]=X.y,E[q++]=X.z,E[q++]=Q.x,E[q++]=Q.y,E[q++]=Q.z),g.st&&(S[M++]=Y,S[M++]=0,S[M++]=Y,S[M++]=1),g.normal||g.tangent||g.bitangent){var $,ee=n.o.clone(n.o.ZERO,H),te=v.scaleToGeodeticSurface(n.o.fromArray(A,K,F),F);if(b+1<k&&($=v.scaleToGeodeticSurface(n.o.fromArray(A,K+3,P),P),ee=n.o.fromArray(A,K+3,H)),J){var oe=n.o.subtract(ee,Q,D),ne=n.o.subtract(te,Q,L);W=n.o.normalize(n.o.cross(ne,oe,W),W),J=!1}n.o.equalsEpsilon($,te,p.e.EPSILON10)?J=!0:(Y+=j,g.tangent&&(V=n.o.normalize(n.o.subtract($,te,V),V)),g.bitangent&&(Z=n.o.normalize(n.o.cross(W,V,Z),Z))),g.normal&&(e.e(y)&&(u.y.multiplyByPoint(w,W,W),n.o.normalize(W,W)),z[N++]=W.x,z[N++]=W.y,z[N++]=W.z,z[N++]=W.x,z[N++]=W.y,z[N++]=W.z),g.tangent&&(R[B++]=V.x,R[B++]=V.y,R[B++]=V.z,R[B++]=V.x,R[B++]=V.y,R[B++]=V.z),g.bitangent&&(I[U++]=Z.x,I[U++]=Z.y,I[U++]=Z.z,I[U++]=Z.x,I[U++]=Z.y,I[U++]=Z.z)}}var ie=new s.a;g.position&&(ie.position=new r.o({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:E})),g.normal&&(ie.normal=new r.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:z})),g.tangent&&(ie.tangent=new r.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:R})),g.bitangent&&(ie.bitangent=new r.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),g.st&&(ie.st=new r.o({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:S}));var ae=C/3;C-=6*(x+1);var re=m.IndexDatatype.createTypedArray(ae,C),se=0;for(b=0;b<ae-2;b+=2){var me=b,pe=b+2,ue=n.o.fromArray(E,3*me,L),le=n.o.fromArray(E,3*pe,F);if(!n.o.equalsEpsilon(ue,le,p.e.EPSILON10)){var ce=b+1,he=b+3;re[se++]=ce,re[se++]=me,re[se++]=he,re[se++]=he,re[se++]=me,re[se++]=pe}}var ge=new r.I({attributes:ie,indices:re,primitiveType:u._0x4e53a2.TRIANGLES,boundingSphere:new o.i.fromVertices(E)});return e.e(t._enuCenter)&&(ge.attributes.position.values.set(f.localPos.topPositions,0),ge.attributes.position.values.set(f.localPos.bottomPositions,ge.attributes.position.values.length/2),ge.attributes.position.componentDatatype=i.ComponentDatatype.FLOAT),ge}},function(o,n){return e.e(n)&&(o=z.unpack(o,n)),o._ellipsoid=t.t.clone(o._ellipsoid),z.createGeometry(o)}}));
