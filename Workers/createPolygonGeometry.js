define(["./defaultValue-a9572088","./Ellipsoid-a181f4f7","./ArcType-31298545","./arrayFill-69e0407a","./BoundingRectangle-ef352e18","./buildModuleUrl-0b6ed7f4","./Cartesian3-9e1fac2b","./Cartographic-832093e6","./Check-1ab97039","./ComponentDatatype-00a8741a","./EllipsoidGeodesic-acb826bd","./EllipsoidTangentPlane-c14b1868","./GeometryAttribute-96eb6e6a","./GeometryInstance-555b318b","./GeometryOffsetAttribute-b4d599f5","./GeometryPipeline-c44b3978","./IndexDatatype-42a29532","./Math-42d8c121","./FeatureDetection-b832308f","./PolygonGeometryLibrary-02cefd62","./PolygonPipeline-2e7b86a0","./Rectangle-15196776","./VertexFormat-54ae028d","./PrimitiveType-56cd8f05","./Cartesian4-c70aabd2","./RuntimeError-7a3815c0","./WebGLConstants-ade65f0f","./defer-027bcf35","./Event-086a9f30","./IntersectionTests-b7b35aa4","./Plane-5520c09d","./AttributeCompression-7ac8aa9b","./EncodedCartesian3-5686f234","./arrayRemoveDuplicates-d492b4a7","./EllipsoidRhumbLine-07313960","./GeometryAttributes-ba165842"],(function(t,e,o,r,a,i,n,s,l,u,p,c,g,y,d,h,m,f,v,_,b,w,T,A,P,x,E,I,H,N,O,C,R,D,F,G){"use strict";var L=new s.a,B=new s.a;function S(t,e,o,r){var a=r.cartesianToCartographic(t,L).height,i=r.cartesianToCartographic(e,B);i.height=a,r.cartographicToCartesian(i,e);var n=r.cartesianToCartographic(o,B);n.height=a-100,r.cartographicToCartesian(n,o)}var V=new a.f,k=new n.o,z=new n.o,M=new n.o,U=new n.o,Y=new n.o,j=new n.o,W=new n.o,q=new n.o,K=new n.o,Q=new e.o,Z=new e.o,J=new n.o,X=new g.n,$=new v.p,tt=new v.p;function et(o){var a=o.vertexFormat,i=o.geometry,s=o.shadowVolume,l=i.attributes.position.values,p=l.length,c=o.wall,y=o.top||c,h=o.bottom||c;if(a.st||a.normal||a.tangent||a.bitangent||s){var m=o.boundingRectangle,_=o.tangentPlane,b=o.ellipsoid,w=o.stRotation,T=o.perPositionHeight,A=Q;A.x=m.x,A.y=m.y;var P,x=o.isComputeTexCoord?new Float32Array(p):new Float32Array(p/3*2),E=a.st?x:void 0;a.normal&&(P=T&&y&&!c?i.attributes.normal.values:new Float32Array(p));var I=a.tangent?new Float32Array(p):void 0,H=a.bitangent?new Float32Array(p):void 0,N=s?new Float32Array(p):void 0,O=0,C=0,R=z,D=M,F=U,G=!0,L=$,B=tt;if(0!==w){var V=g.n.fromAxisAngle(_._plane.normal,w,X);L=v.p.fromQuaternion(V,L),V=g.n.fromAxisAngle(_._plane.normal,-w,X),B=v.p.fromQuaternion(V,B)}else L=v.p.clone(v.p.IDENTITY,L),B=v.p.clone(v.p.IDENTITY,B);var et=0,ot=0;y&&h&&(et=p/2,ot=p/3,p/=2);for(var rt=0;rt<p;rt+=3){var at=n.o.fromArray(l,rt,J);if(a.st){var it=v.p.multiplyByVector(L,at,k);it=b.scaleToGeodeticSurface(it,it);var nt=_.projectPointOntoPlane(it,Z);e.o.subtract(nt,A,nt);var st=f.e.clamp(nt.x/m.width,0,1),lt=f.e.clamp(nt.y/m.height,0,1);h&&(E[O+ot]=st,E[O+1+ot]=lt),y&&(E[O]=st,E[O+1]=lt),O+=2}if(a.normal||a.tangent||a.bitangent||s){var ut=C+1,pt=C+2;if(c){if(rt+3<p){var ct=n.o.fromArray(l,rt+3,Y);if(G){var gt=n.o.fromArray(l,rt+p,j);T&&S(at,ct,gt,b),n.o.subtract(ct,at,ct),n.o.subtract(gt,at,gt),R=n.o.normalize(n.o.cross(gt,ct,R),R),G=!1}n.o.equalsEpsilon(ct,at,f.e.EPSILON10)&&(G=!0)}(a.tangent||a.bitangent)&&(F=b.geodeticSurfaceNormal(at,F),a.tangent&&(D=n.o.normalize(n.o.cross(F,R,D),D)))}else R=b.geodeticSurfaceNormal(at,R),(a.tangent||a.bitangent)&&(T&&(W=n.o.fromArray(P,C,W),q=n.o.cross(n.o.UNIT_Z,W,q),q=n.o.normalize(v.p.multiplyByVector(B,q,q),q),a.bitangent&&(K=n.o.normalize(n.o.cross(W,q,K),K))),D=n.o.cross(n.o.UNIT_Z,R,D),D=n.o.normalize(v.p.multiplyByVector(B,D,D),D),a.bitangent&&(F=n.o.normalize(n.o.cross(R,D,F),F)));a.normal&&(o.wall?(P[C+et]=R.x,P[ut+et]=R.y,P[pt+et]=R.z):h&&(P[C+et]=-R.x,P[ut+et]=-R.y,P[pt+et]=-R.z),(y&&!T||c)&&(P[C]=R.x,P[ut]=R.y,P[pt]=R.z)),s&&(c&&(R=b.geodeticSurfaceNormal(at,R)),N[C+et]=-R.x,N[ut+et]=-R.y,N[pt+et]=-R.z),a.tangent&&(o.wall?(I[C+et]=D.x,I[ut+et]=D.y,I[pt+et]=D.z):h&&(I[C+et]=-D.x,I[ut+et]=-D.y,I[pt+et]=-D.z),y&&(T?(I[C]=q.x,I[ut]=q.y,I[pt]=q.z):(I[C]=D.x,I[ut]=D.y,I[pt]=D.z))),a.bitangent&&(h&&(H[C+et]=F.x,H[ut+et]=F.y,H[pt+et]=F.z),y&&(T?(H[C]=K.x,H[ut]=K.y,H[pt]=K.z):(H[C]=F.x,H[ut]=F.y,H[pt]=F.z))),C+=3}}a.st&&(i.attributes.st=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:E})),a.normal&&(i.attributes.normal=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P})),a.tangent&&(i.attributes.tangent=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),a.bitangent&&(i.attributes.bitangent=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:H})),s&&(i.attributes.extrudeDirection=new g.o({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:N}))}if(o.extrude&&t.e(o.offsetAttribute)){var yt=l.length/3,dt=new Uint8Array(yt);if(o.offsetAttribute===d.z.TOP)y&&h||c?dt=r.d(dt,1,0,yt/2):y&&(dt=r.d(dt,1));else{var ht=o.offsetAttribute===d.z.NONE?0:1;dt=r.d(dt,ht)}i.attributes.applyOffset=new g.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:dt})}return i}var ot=new s.a,rt=new s.a,at={west:0,east:0},it=new p.E;function nt(e,r,a,i,n){if(n=t.u(n,new w.h),!t.e(e)||e.length<3)return n.west=0,n.north=0,n.south=0,n.east=0,n;if(a===o.L.RHUMB)return w.h.fromCartesianArray(e,r,n);it.ellipsoid.equals(r)||(it=new p.E(void 0,void 0,r)),n.west=Number.POSITIVE_INFINITY,n.east=Number.NEGATIVE_INFINITY,n.south=Number.POSITIVE_INFINITY,n.north=Number.NEGATIVE_INFINITY,at.west=Number.POSITIVE_INFINITY,at.east=Number.NEGATIVE_INFINITY;for(var s,l=1/f.e.chordLength(i,r.maximumRadius),u=e.length,c=r.cartesianToCartographic(e[0],rt),g=ot,y=1;y<u;y++)s=g,g=c,c=r.cartesianToCartographic(e[y],s),it.setEndPoints(g,c),lt(it,l,n,at);return s=g,g=c,c=r.cartesianToCartographic(e[0],s),it.setEndPoints(g,c),lt(it,l,n,at),n.east-n.west>at.west-at.east&&(n.east=at.east,n.west=at.west),n}var st=new s.a;function lt(t,e,o,r){for(var a=t.surfaceDistance,i=Math.ceil(a*e),n=i>0?a/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=t.interpolateUsingSurfaceDistance(s,st);s+=n;var p=u.longitude,c=u.latitude;o.west=Math.min(o.west,p),o.east=Math.max(o.east,p),o.south=Math.min(o.south,c),o.north=Math.max(o.north,c),r.west=p>0?Math.min(p,r.west):r.west,r.east=p<0?Math.max(p,r.east):r.east}}var ut=[];function pt(t,e,o,r,a,i,n,s,l,u){var p,g={walls:[]};if(i||n){var d,h,f=_.y.createGeometryFromPositions(t,e,o,a,s,l),v=f.attributes.position.values,w=f.indices;if(i&&n){var T=v.concat(v);d=T.length/3,(h=m.IndexDatatype.createTypedArray(d,2*w.length)).set(w);var A=w.length,P=d/2;for(p=0;p<A;p+=3){var x=h[p]+P,E=h[p+1]+P,I=h[p+2]+P;h[p+A]=I,h[p+1+A]=E,h[p+2+A]=x}if(f.attributes.position.values=T,a&&s.normal){var H=f.attributes.normal.values;f.attributes.normal.values=new Float32Array(T.length),f.attributes.normal.values.set(H)}f.indices=h}else if(n){for(d=v.length/3,h=m.IndexDatatype.createTypedArray(d,w.length),p=0;p<w.length;p+=3)h[p]=w[p+2],h[p+1]=w[p+1],h[p+2]=w[p];f.indices=h}g.topAndBottom=new y.d({geometry:f})}var N,O=r.outerRing,C=c.f.fromPoints(O,t),R=C.projectPointsOntoPlane(O,ut),D=b.A.computeWindingOrder2D(R);D===b.W.CLOCKWISE&&(O=O.slice().reverse()),u&&(N=_.y.computeWallGeometry(O,t,o,a,l),g.walls.push(new y.d({geometry:N})));var F=r.holes;for(p=0;p<F.length;p++){var G=F[p];R=(C=c.f.fromPoints(G,t)).projectPointsOntoPlane(G,ut),(D=b.A.computeWindingOrder2D(R))===b.W.COUNTER_CLOCKWISE&&(G=G.slice().reverse()),N=_.y.computeWallGeometry(G,t,o,a,l),g.walls.push(new y.d({geometry:N}))}return g}function ct(r){if(l.o.typeOf.object("options",r),l.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy),t.e(r.perPositionHeight)&&r.perPositionHeight&&t.e(r.height))throw new l.t("Cannot use both options.perPositionHeight and options.height");if(t.e(r.arcType)&&r.arcType!==o.L.GEODESIC&&r.arcType!==o.L.RHUMB)throw new l.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var a=r.polygonHierarchy,i=t.u(r.vertexFormat,T.n.DEFAULT),n=t.u(r.ellipsoid,e.t.WGS84),s=t.u(r.granularity,f.e.RADIANS_PER_DEGREE),u=t.u(r.stRotation,0),p=t.u(r.perPositionHeight,!1),c=p&&t.e(r.extrudedHeight),g=t.u(r.height,0),y=t.u(r.extrudedHeight,g);if(!c){var d=Math.max(g,y);y=Math.min(g,y),g=d}this._vertexFormat=T.n.clone(i),this._ellipsoid=e.t.clone(n),this._granularity=s,this._stRotation=u,this._height=g,this._extrudedHeight=y,this._closeTop=t.u(r.closeTop,!0),this._closeBottom=t.u(r.closeBottom,!0),this._extrudeOutering=t.u(r.extrudeOutering,!0),this._polygonHierarchy=a,this._perPositionHeight=p,this._perPositionHeightExtrude=c,this._shadowVolume=t.u(r.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=r.offsetAttribute,this._arcType=t.u(r.arcType,o.L.GEODESIC),this._groundBottomAltitude=t.u(r.groundBottomAltitude,0),this._groundExtrudedHeight=t.u(r.groundExtrudedHeight,0),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=_.y.computeHierarchyPackedLength(a)+e.t.packedLength+T.n.packedLength+12}ct.fromPositions=function(e){return e=t.u(e,t.u.EMPTY_OBJECT),l.o.defined("options.positions",e.positions),new ct({polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,closeTop:e.closeTop,closeBottom:e.closeBottom,offsetAttribute:e.offsetAttribute,arcType:e.arcType})},ct.pack=function(o,r,a){return l.o.typeOf.object("value",o),l.o.defined("array",r),a=t.u(a,0),a=_.y.packPolygonHierarchy(o._polygonHierarchy,r,a),e.t.pack(o._ellipsoid,r,a),a+=e.t.packedLength,T.n.pack(o._vertexFormat,r,a),a+=T.n.packedLength,r[a++]=o._height,r[a++]=o._extrudedHeight,r[a++]=o._granularity,r[a++]=o._stRotation,r[a++]=o._perPositionHeightExtrude?1:0,r[a++]=o._perPositionHeight?1:0,r[a++]=o._closeTop?1:0,r[a++]=o._closeBottom?1:0,r[a++]=o._shadowVolume?1:0,r[a++]=t.u(o._offsetAttribute,-1),r[a++]=o._arcType,r[a]=o.packedLength,r};var gt=e.t.clone(e.t.UNIT_SPHERE),yt=new T.n,dt={polygonHierarchy:{}};return ct.unpack=function(o,r,a){l.o.defined("array",o),r=t.u(r,0);var i=_.y.unpackPolygonHierarchy(o,r);r=i.startingIndex,delete i.startingIndex;var n=e.t.unpack(o,r,gt);r+=e.t.packedLength;var s=T.n.unpack(o,r,yt);r+=T.n.packedLength;var u=o[r++],p=o[r++],c=o[r++],g=o[r++],y=1===o[r++],d=1===o[r++],h=1===o[r++],m=1===o[r++],f=1===o[r++],v=o[r++],b=o[r++],w=o[r];return t.e(a)||(a=new ct(dt)),a._polygonHierarchy=i,a._ellipsoid=e.t.clone(n,a._ellipsoid),a._vertexFormat=T.n.clone(s,a._vertexFormat),a._height=u,a._extrudedHeight=p,a._granularity=c,a._stRotation=g,a._perPositionHeightExtrude=y,a._perPositionHeight=d,a._closeTop=h,a._closeBottom=m,a._shadowVolume=f,a._offsetAttribute=-1===v?void 0:v,a._arcType=b,a.packedLength=w,a},ct.computeRectangle=function(r,a){l.o.typeOf.object("options",r),l.o.typeOf.object("options.polygonHierarchy",r.polygonHierarchy);var i=t.u(r.granularity,f.e.RADIANS_PER_DEGREE),n=t.u(r.arcType,o.L.GEODESIC);if(n!==o.L.GEODESIC&&n!==o.L.RHUMB)throw new l.t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var s=r.polygonHierarchy,u=t.u(r.ellipsoid,e.t.WGS84);return nt(s.positions,u,n,i,a)},ct.createGeometry=function(e){var o=e._vertexFormat,a=e._ellipsoid,n=e._granularity,s=e._stRotation,l=e._polygonHierarchy,p=e._perPositionHeight,v=e._closeTop,w=e._closeBottom,T=e._arcType,A=l.positions;if(!(A.length<3)){var P=c.f.fromPoints(A,a),x=_.y.polygonsFromHierarchy(l,P.projectPointsOntoPlane.bind(P),!p,a),E=x.hierarchy,I=x.polygons;if(0!==E.length){A=E[0].outerRing;var H,N=_.y.computeBoundingRectangle(P.plane.normal,P.projectPointOntoPlane.bind(P),A,s,V),O=[],C=e._height,R=e._extrudedHeight,D={perPositionHeight:p,vertexFormat:o,geometry:void 0,tangentPlane:P,boundingRectangle:N,ellipsoid:a,stRotation:s,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:T};if(e._perPositionHeightExtrude||!f.e.equalsEpsilon(C,R,0,f.e.EPSILON2))for(D.extrude=!0,D.top=v,D.bottom=w,D.shadowVolume=e._shadowVolume,D.offsetAttribute=e._offsetAttribute,H=0;H<I.length;H++){var F,G=pt(a,I[H],n,E[H],p,v,w,o,T,e._extrudeOutering);v&&w?(F=G.topAndBottom,D.geometry=_.y.scaleToGeodeticHeightExtruded(F.geometry,C,R,a,p)):v?((F=G.topAndBottom).geometry.attributes.position.values=b.A.scaleToGeodeticHeight(F.geometry.attributes.position.values,C,a,!p),D.geometry=F.geometry):w&&((F=G.topAndBottom).geometry.attributes.position.values=b.A.scaleToGeodeticHeight(F.geometry.attributes.position.values,R,a,!0),D.geometry=F.geometry),(v||w)&&(D.wall=!1,F.geometry=et(D),O.push(F));var L=G.walls;D.wall=!0;for(var B=0;B<L.length;B++){var S=L[B];D.geometry=_.y.scaleToGeodeticHeightExtruded(S.geometry,C,R,a,p),S.geometry=et(D),O.push(S)}}else for(H=0;H<I.length;H++){var k=new y.d({geometry:_.y.createGeometryFromPositions(a,I[H],n,p,o,T)});if(k.geometry.attributes.position.values=b.A.scaleToGeodeticHeight(k.geometry.attributes.position.values,C,a,!p),D.geometry=k.geometry,k.geometry=et(D),t.e(e._offsetAttribute)){var z=k.geometry.attributes.position.values.length,M=new Uint8Array(z/3),U=e._offsetAttribute===d.z.NONE?0:1;r.d(M,U),k.geometry.attributes.applyOffset=new g.o({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:M})}O.push(k)}var Y=h.k.combineInstances(O)[0];Y.attributes.position.values=new Float64Array(Y.attributes.position.values),Y.indices=m.IndexDatatype.createTypedArray(Y.attributes.position.values.length/3,Y.indices);var j=Y.attributes,W=i.i.fromVertices(j.position.values);return o.position||delete j.position,new g.I({attributes:j,indices:Y.indices,primitiveType:Y.primitiveType,boundingSphere:W,offsetAttribute:e._offsetAttribute})}}},ct.createShadowVolume=function(t,e,o){var r=t._granularity,a=t._ellipsoid,i=t._groundBottomAltitude+t._groundExtrudedHeight,n=t._groundBottomAltitude?t._groundBottomAltitude:e(r,a),s=i!==t._groundBottomAltitude?i:o(r,a);return new ct({polygonHierarchy:t._polygonHierarchy,ellipsoid:a,stRotation:t._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:n,height:s,vertexFormat:T.n.POSITION_ONLY,shadowVolume:!0,arcType:t._arcType})},Object.defineProperties(ct.prototype,{rectangle:{get:function(){if(!t.e(this._rectangle)){var e=this._polygonHierarchy.positions;this._rectangle=nt(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return t.e(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0===e)return[0,0,0,1,1,0];var o=t._ellipsoid,r=t._polygonHierarchy.positions,a=t.rectangle;return g.I._textureCoordinateRotationPoints(r,e,o,a)}(this)),this._textureCoordinateRotationPoints}}}),function(o,r){return t.e(r)&&(o=ct.unpack(o,r)),o._ellipsoid=e.t.clone(o._ellipsoid),ct.createGeometry(o)}}));
